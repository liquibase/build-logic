name: Check for open Dependabot PRs
on:
  workflow_call:
  workflow_dispatch:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  check_for_prs:
    name: Check for open Dependabot PRs
    runs-on: ubuntu-latest
    steps:
      - name: Check for open Dependabot PRs
        run: |
          echo $GITHUB_REPOSITORY
          gh pr list --repo $GITHUB_REPOSITORY
          open_prs=$(gh pr list --repo $GITHUB_REPOSITORY --author dependabot[bot] --state open --json title,url \
            | jq -r '.[] | "\(.title) \(.url)"')

          if [ -n "$open_prs" ]; then
            echo "Found open Dependabot PRs:"
            echo "$open_prs"
            exit 1
          else
            echo "No open Dependabot PRs found."
          fi
